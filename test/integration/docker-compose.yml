name: "go-ship-test"
services:
    shared:
        build:
            context: docker/shared
            dockerfile: Dockerfile
        volumes:
            - shared-ssh:/work/ssh
        networks:
            - app-network

    vm1:
        build:
            context: docker/vm
            dockerfile: Dockerfile
        volumes:
            - shared-ssh:/shared/ssh:ro
        networks:
            - app-network
        depends_on:
            - shared
    vm2:
        build:
            context: docker/vm
            dockerfile: Dockerfile
        volumes:
            - shared-ssh:/shared/ssh:ro
        networks:
            - app-network
        depends_on:
            - shared

    app:
        build:
            context: docker/app
            dockerfile: Dockerfile
        volumes:
            - shared-ssh:/shared/ssh:ro
        networks:
            - app-network
        depends_on:
            - shared
            - vm1
            - vm2

networks:
    app-network:
        driver: bridge

volumes:
    shared-ssh:
